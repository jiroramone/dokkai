<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>発達支援アプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap');
        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background-color: #f3f4f6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="container bg-white shadow-xl rounded-2xl p-6 md:p-10 text-center">
        <!-- Main Title -->
        <h1 class="text-3xl md:text-5xl font-bold text-gray-800 mb-6 md:mb-10">ぶんしょうどっかいげーむ</h1>

        <!-- Story Selection Screen -->
        <div id="story-selection-screen" class="space-y-6">
            <h2 class="text-2xl md:text-3xl font-bold text-gray-700 mb-4">すきなおはなしを えらんでね！</h2>
            <div id="story-options-container" class="grid gap-4 sm:grid-cols-2">
                <button data-story="ももたろう" class="story-select-btn py-4 px-8 rounded-full font-bold text-gray-800 bg-yellow-300 hover:bg-yellow-400 shadow-lg transform transition-all duration-300 hover:scale-105">
                    ももたろう
                </button>
                <button data-story="うさぎとかめ" class="story-select-btn py-4 px-8 rounded-full font-bold text-gray-800 bg-green-300 hover:bg-green-400 shadow-lg transform transition-all duration-300 hover:scale-105">
                    うさぎとかめ
                </button>
                <button data-story="おおきなかぶ" class="story-select-btn py-4 px-8 rounded-full font-bold text-gray-800 bg-red-300 hover:bg-red-400 shadow-lg transform transition-all duration-300 hover:scale-105">
                    おおきなかぶ
                </button>
                <button data-story="あかずきん" class="story-select-btn py-4 px-8 rounded-full font-bold text-gray-800 bg-blue-300 hover:bg-blue-400 shadow-lg transform transition-all duration-300 hover:scale-105">
                    あかずきん
                </button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="game-area" class="space-y-6 hidden">
            <!-- Content Area (Story/Scenario) -->
            <div id="content-display" class="bg-gray-50 p-6 rounded-lg shadow-inner min-h-[150px] flex items-center justify-center text-left">
                <p id="game-text" class="text-lg md:text-xl text-gray-700 leading-relaxed"></p>
            </div>

            <!-- Question/Prompt Area -->
            <div id="prompt-display" class="bg-gray-100 p-4 rounded-lg shadow-sm">
                <p id="game-prompt" class="text-xl md:text-2xl font-bold text-gray-800"></p>
            </div>

            <!-- Answer Options -->
            <div id="options-container" class="grid gap-4 sm:grid-cols-2">
                <!-- Buttons will be injected here by JavaScript -->
            </div>
            
            <!-- Feedback Message -->
            <div id="feedback-container" class="min-h-[50px] flex items-center justify-center">
                <p id="feedback-message" class="text-2xl font-bold"></p>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex flex-col sm:flex-row gap-4 items-center justify-center">
                <button id="back-to-selection-btn" class="w-full sm:w-1/2 py-3 px-6 rounded-full font-bold text-gray-800 bg-gray-300 hover:bg-gray-400 shadow-lg transform transition-all duration-300 hover:scale-105">
                    もどる
                </button>
                <button id="next-btn" class="w-full sm:w-1/2 py-3 px-6 rounded-full font-bold text-white bg-green-500 hover:bg-green-600 shadow-lg transform transition-all duration-300 hover:scale-105 hidden">
                    つぎのもんだいへ
                </button>
            </div>
        </div>
    </div>

    <script>
        // グローバル変数
        let currentQuestions = [];
        let currentQuestionIndex = 0;

        // UIエレメント
        const storySelectionScreen = document.getElementById('story-selection-screen');
        const gameArea = document.getElementById('game-area');
        const storyOptionsContainer = document.getElementById('story-options-container');
        const gameText = document.getElementById('game-text');
        const gamePrompt = document.getElementById('game-prompt');
        const optionsContainer = document.getElementById('options-container');
        const feedbackMessage = document.getElementById('feedback-message');
        const nextBtn = document.getElementById('next-btn');
        const backToSelectionBtn = document.getElementById('back-to-selection-btn');

        // あらかじめ用意した童話と問題のデータ
        const storyData = {
            "ももたろう": {
                text: "むかしむかし、おじいさんとおばあさんがいました。おばあさんがかわでせんたくをしていると、おおきなももがながれてきました。ももをもちかえってわってみると、なかからげんきなこどもがうまれました。ももからうまれたので、ももたろうとよばれました。ももたろうは、きびだんごをもって、おにをたいじにしゅっぱつしました。とちゅうで、いぬとさるときじをなかまにして、おにがしまへむかいました。みんなでちからをあわせて、おにをたいじしました。",
                questions: [
                    {
                        prompt: "ももたろうがうまれたのは、どこからですか？",
                        options: ["きびだんご", "もも", "いぬ"],
                        correct: 1
                    },
                    {
                        prompt: "ももたろうが、おにたいじにむかうときにもっていたものはなに？",
                        options: ["かばん", "きびだんご", "おもちゃ"],
                        correct: 1
                    },
                    {
                        prompt: "ももたろうのなかまになったいきものはどれ？",
                        options: ["ねこ", "くま", "いぬ"],
                        correct: 2
                    }
                ]
            },
            "うさぎとかめ": {
                text: "うさぎと かめが くらべっこを することに なりました。うさぎは とても はやく はしりますが、かめは ゆっくりしか うごきません。うさぎは かめをばかにして、とちゅうでねてしまいました。かめはゆっくりとあるきつづけて、さいごにゴールしました。",
                questions: [
                    {
                        prompt: "うさぎは どのように はしりますか？",
                        options: ["ゆっくり", "はやく", "ぴょんぴょん"],
                        correct: 1
                    },
                    {
                        prompt: "かめは どのように うごきますか？",
                        options: ["ゆっくり", "はやく", "ぴょんぴょん"],
                        correct: 0
                    },
                    {
                        prompt: "うさぎはゴールするまえに、なにをしましたか？",
                        options: ["うたをうたった", "ねてしまった", "ごはんをたべた"],
                        correct: 1
                    }
                ]
            },
            "おおきなかぶ": {
                text: "おじいさんとおばあさんがいました。おじいさんがかぶのたねをまきました。かぶはどんどんおおきくなりました。おじいさんがぬこうとしましたが、ぬけません。おばあさん、まご、いぬ、ねこ、ねずみがつぎつぎにてつだいました。みんなでちからをあわせて、「うんとこしょ、どっこいしょ」とひっぱると、おおきなかぶがやっとぬけました。",
                questions: [
                    {
                        prompt: "おじいさんがまいたものは、なに？",
                        options: ["にんじん", "かぶのたね", "もも"],
                        correct: 1
                    },
                    {
                        prompt: "かぶをぬくのをてつだったのは、だれですか？",
                        options: ["おじいさん", "おばあさん", "まご", "いぬ", "ねこ", "ねずみ"],
                        correct: 5
                    },
                    {
                        prompt: "みんなで「うんとこしょ、どっこいしょ」とひっぱったものはなに？",
                        options: ["おおきなかぶ", "おおきないし", "おおきなき"],
                        correct: 0
                    }
                ]
            },
            "あかずきん": {
                text: "むかしむかし、かわいいおんなのこがいました。いつでもあかいいずきんをかぶっていたので、あかずきんとよばれていました。あるひ、おおかみがばあさんをたべて、あかずきんになりすましました。あかずきんがたずねると、おおかみはあかずきんもたべてしまいました。そのあと、きこりがおおかみのなかにいるふたりをみつけて、たすけだしました。",
                questions: [
                    {
                        prompt: "おんなのこは、どんなふくをきていましたか？",
                        options: ["あかいいずきん", "あおいずきん", "きいろいずきん"],
                        correct: 0
                    },
                    {
                        prompt: "おおかみにたべられてしまったのは、だれですか？",
                        options: ["おじいさん", "きこり", "ばあさんとあかずきん"],
                        correct: 2
                    },
                    {
                        prompt: "さいごに、おおかみのなかからふたりをたすけだしたのは、だれですか？",
                        options: ["きこり", "いぬ", "ももたろう"],
                        correct: 0
                    }
                ]
            }
        };

        /**
         * 選択された物語の問題をセットして、ゲーム画面に切り替える
         * @param {string} storyKey 選択された物語のキー
         */
        function startStoryGame(storyKey) {
            storySelectionScreen.classList.add('hidden');
            gameArea.classList.remove('hidden');

            const selectedStory = storyData[storyKey];
            currentQuestions = selectedStory.questions.map(q => ({
                text: selectedStory.text,
                ...q
            }));
            currentQuestionIndex = 0;
            displayQuestion();
        }

        /**
         * 現在の問題を表示する
         */
        function displayQuestion() {
            // 全問終了後の処理
            if (currentQuestionIndex >= currentQuestions.length) {
                gameText.textContent = "おしまい！よく がんばりました！";
                gamePrompt.textContent = "";
                optionsContainer.innerHTML = "";
                nextBtn.classList.remove('hidden');
                nextBtn.textContent = "ほかのおはなしをえらぶ";
                feedbackMessage.textContent = "";
                return;
            }

            const currentItem = currentQuestions[currentQuestionIndex];
            
            // UIをリセット
            gameText.textContent = currentItem.text;
            gamePrompt.textContent = currentItem.prompt;
            optionsContainer.innerHTML = "";
            nextBtn.classList.add('hidden');
            backToSelectionBtn.classList.remove('hidden');
            feedbackMessage.textContent = "";

            // 選択肢ボタンを表示
            currentItem.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.textContent = option;
                button.classList.add(
                    'py-3', 'px-6', 'rounded-xl', 'font-bold', 'text-gray-800', 
                    'bg-gray-200', 'hover:bg-blue-300', 'transition-all', 'duration-300',
                    'shadow-sm', 'hover:shadow-lg', 'transform', 'hover:scale-105'
                );
                button.addEventListener('click', () => handleAnswer(index));
                optionsContainer.appendChild(button);
            });
        }

        /**
         * ユーザーの回答を処理する
         * @param {number} selectedIndex 選択された選択肢のインデックス
         */
        function handleAnswer(selectedIndex) {
            const currentItem = currentQuestions[currentQuestionIndex];
            
            // ボタンを無効化
            Array.from(optionsContainer.children).forEach(button => {
                button.disabled = true;
            });

            if (selectedIndex === currentItem.correct) {
                feedbackMessage.textContent = "せいかい！";
                feedbackMessage.classList.add('text-green-600');
                feedbackMessage.classList.remove('text-red-600');
            } else {
                feedbackMessage.textContent = "ざんねん...もういちど かんがえてみよう！";
                feedbackMessage.classList.add('text-red-600');
                feedbackMessage.classList.remove('text-green-600');
            }
            nextBtn.classList.remove('hidden');
            nextBtn.textContent = "つぎのもんだいへ";
        }

        /**
         * 次の問題に進むか、物語選択画面に戻る
         */
        function goToNextQuestion() {
            if (currentQuestionIndex >= currentQuestions.length - 1) {
                // 全問終了後、物語選択画面に戻る
                displayStorySelection();
            } else {
                currentQuestionIndex++;
                displayQuestion();
            }
        }

        /**
         * 物語の選択画面を表示する
         */
        function displayStorySelection() {
            gameArea.classList.add('hidden');
            storySelectionScreen.classList.remove('hidden');
        }

        // イベントリスナー
        storyOptionsContainer.querySelectorAll('.story-select-btn').forEach(button => {
            button.addEventListener('click', (e) => {
                const storyKey = e.target.dataset.story;
                startStoryGame(storyKey);
            });
        });

        nextBtn.addEventListener('click', goToNextQuestion);
        backToSelectionBtn.addEventListener('click', displayStorySelection);

        // 初期設定
        window.onload = function() {
            displayStorySelection();
        };

    </script>
</body>
</html>



